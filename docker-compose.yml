version: "3.8"
services:
  samba:
    image: dperson/samba:latest
    container_name: samba
    
    # We are using network_mode: "host" as per your last file. 
    # This bypasses port mapping, but provides direct LAN access.
    network_mode: "host" 
    
    # --- dperson/samba Environment Variables ---
    environment:
      # Mapped from .env: Set the UID/GID for permission enforcement
      - USERID=$SAMBA_PUID   
      - GROUPID=$SAMBA_PGID
      - TZ=$TZ
      - WORKGROUP=HOMELAB # Optional: Set a specific workgroup name
      
    volumes:
      # V-1: Map Disk 1 (Shared) 
      - $HOST_DISK_1_PATH:$SHARE_1_PATH:rw

      # V-2: Map Disk 2 (Private) 
      - $HOST_DISK_2_PATH:$SHARE_2_PATH:rw
    
    # --- CRITICAL: Defines Users and Shares using the documentation syntax ---
    # The command uses variables from the .env file.
    command: >
      -u "$ADMIN_USER;$ADMIN_PASS" 
      -u "$GUEST_USER;$GUEST_PASS"
      -s "$SHARE_1_NAME;$SHARE_1_PATH;yes;no;no;@$SHARE_1_USERS" # Disk 1: R/W for Group (@nas_rw_group)
      -s "$SHARE_2_NAME;$SHARE_2_PATH;yes;no;no;$SHARE_2_USERS" # Disk 2: R/W for Admin only
      -p 

    cap_add:
      - NET_ADMIN
    restart: unless-stopped

# --- TOP LEVEL NETWORK DEFINITION ---
networks:
  app_net:
    external: true
